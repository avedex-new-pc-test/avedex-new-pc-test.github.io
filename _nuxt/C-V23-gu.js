import{n as a,bw as e,ax as t,gi as l,D as r,F as i,au as o,M as s,fi as n,c,o as m,b as u,a as d,w as p,J as f,t as g,E as b,K as v,cO as C,d as h,a8 as x,a5 as S,cY as y,aq as w,H as N,aK as z,S as I,bA as j,qq as _}from"./Ck65DhTU.js";import{E as O,a as P}from"./DnulTJLV.js";import"./BwAGr_Cw.js";import"./CPubcWut.js";import{a as V}from"./DStMXlD-.js";import{b as D}from"./D72IwgTQ.js";import"./BZz6c_uP.js";import"./Cjh5n7V4.js";import"./BtHoUnZy.js";import"./CfgshW7J.js";import"./Dw5t3e-8.js";import"./3zf6s2PU.js";import"./BbIkpTl9.js";import"./B4EhLJjm.js";import"./DsxdcEHf.js";const L=["infinite-scroll-disabled"],M={class:"text-12px"},Y={key:1},B={class:"text-14px"},k={class:"mt-[2px] mb-[5px] py-[10px] text-[12px] text-center color-[--third-text]"},H={key:0},T=a({__name:"positionHistory",props:{searchParams:{}},setup(a){const T=e(),q=a,{t:A}=t(),F=l(),U=o([]),E=i({loading:!1,finished:!1,error:!1}),K=i(""),J=b(()=>{var a,e,t;const l=(null==(t=null==(e=null==(a=F.metadata)?void 0:a.contractList)?void 0:e.reduce)?void 0:t.call(e,(a,e)=>(a[e.contractId]=e.contractName,a),{}))||{};return l.ALL=A("all"),l}),Q=a=>Math.abs(a.cumOpenSize)!==Math.abs(a.cumCloseSize),R=a=>{var e;const t=(null==(e=F.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,l=new j(0).minus(a.cumOpenValue).minus(a.cumCloseValue);return Q(a)?l.plus(t):l},Z=a=>{var e;const t=R(a);if(!a.currentLeverage)return new j(0);{const l=(null==(e=F.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,r=Q(a)?new j(a.cumOpenValue).abs().minus(new j(l).abs()):new j(a.cumOpenValue).abs();return r.isZero()?new j(0):t.dividedBy(r).multipliedBy(100).multipliedBy(a.currentLeverage)}},$=async()=>{var a,e;if(E.value.loading||E.value.finished)return;const t={...q.searchParams};K.value&&(t.offsetData=K.value);try{E.value.loading=!0;const l=await _(t);let r=(null==(e=null==(a=l.dataList)?void 0:a.filter)?void 0:e.call(a,a=>Math.abs(a.cumCloseSize)>0))||[];K.value&&(r=U.value.concat(r)),l.nextPageOffsetData||(E.value.finished=!0),K.value=l.nextPageOffsetData,U.value=r}catch(l){E.value.error=!0}finally{E.value.loading=!1}};T.address&&$();const G=a=>{var e,t;const l=(null==(t=null==(e=F.contractList)?void 0:e.find(e=>e.contractId===a.contractId))?void 0:t.oraclePrice)||0;return j(a.openSize).multipliedBy(l).minus(a.openValue).toString()},W=a=>{const e=G(a);return j(e).dividedBy(j(a.openValue).abs()).multipliedBy(100).multipliedBy(a.leverage).toString()};return r(()=>[q.searchParams,T.address],()=>{K.value="",U.value=[],E.value.finished=!1,E.value.error=!1,E.value.loading=!1,$()}),(a,e)=>{const t=z,l=O,r=P,i=n;return s((m(),c("div",{class:"relative min-h-400px bg-[--secondary-bg]","infinite-scroll-delay":200,"infinite-scroll-disabled":f(E).loading||f(E).finished||f(E).error,"infinite-scroll-immediate":!1,"infinite-scroll-distance":300},[u(r,{fit:"",data:f(U),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:p(()=>{var e;return[f(E).loading||0!==(null==(e=f(U))?void 0:e.length)?(m(),c("span",Y)):(m(),N(t,{key:0,class:"pt-[40px]"},{default:p(()=>[d("span",M,g(a.$t("emptyNoData")),1)]),_:1}))]}),default:p(()=>[u(l,{label:f(A)("markets1"),prop:"contractId"},{default:p(({row:e})=>[d("span",B,g(f(J)[e.contractId]),1),d("div",{class:v(["text-10px lh-14px",("getColorClass"in a?a.getColorClass:f(C))(e.cumOpenSize)])},g(e.cumOpenSize>0?f(A)("long"):f(A)("short")),3)]),_:1},8,["label"]),u(l,{label:f(A)("Qty"),prop:"contractSize"},{default:p(({row:e})=>[h(g(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenSize)||0))+" "+g(f(J)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("closeSize")},{default:p(({row:e})=>[h(g(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseSize)||0))+" "+g(f(J)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("status")},{default:p(({row:a})=>[h(g(Q(a)?f(A)("partialClose"):f(A)("closed")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("openAvgPrice")},{default:p(({row:e})=>[h(g(("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenValue/e.cumOpenSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("avgPrice2")},{default:p(({row:e})=>[h(g(("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseValue/e.cumCloseSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("unrealizedPnl")},{default:p(({row:e})=>[Q(e)?(m(),c(S,{key:0},[d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))(G(e))])},g(("formatNumber"in a?a.formatNumber:f(x))(G(e),2)),3),d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))(W(e))])},g(("formatNumber"in a?a.formatNumber:f(x))(W(e),{limit:20,decimals:2}))+"% ",3)],64)):(m(),c(S,{key:1},[h("--")],64))]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("pnl")},{default:p(({row:e})=>{var t,l,r;return[d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))(R(e).toString())])},g(("formatNumber"in a?a.formatNumber:f(x))(R(e).toString())),3),d("div",{class:v(["lh-18px flex items-center justify-end gap-4px",("getColorClass"in a?a.getColorClass:f(C))(Z(e).toString())])},[h(g(("formatNumber"in a?a.formatNumber:f(x))(Z(e).toString(),{limit:20,decimals:2}))+"% ",1),u(D,{statistics:{leverage:("getLeverageFromContractId"in a?a.getLeverageFromContractId:f(V))(e.contractId)||e.maxLeverage,openValue:e.cumOpenValue,entryPrice:("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenValue/e.cumOpenSize,{decimals:2,limit:20}),unrealizedPnl:R(e).toString(),unrealizedPnlRate:Z(e).toString(),name:null==(l=null==(t=f(J)[e.contractId])?void 0:t.replace)?void 0:l.call(t,"USD",""),logo_url:null==(r=f(F).contractList.find(a=>a.contractId===e.contractId))?void 0:r.baseCoinIcon,closePrice:("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseValue/e.cumCloseSize,{decimals:2,limit:20})}},null,8,["statistics"])],2)]}),_:1},8,["label"]),u(l,{align:"right",label:f(A)("termCount")},{default:p(({row:e})=>[h(g(Q(e)?"--":("formatCountdown"in a?a.formatCountdown:f(y))(0,!1,f(w)(+e.updatedTime).diff(f(w)(+e.createdTime),"s"))),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("openTime2")},{default:p(({row:a})=>[h(g(f(w)(+a.createdTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(A)("lastCloseTime")},{default:p(({row:a})=>[h(g(f(w)(+a.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"])]),_:1},8,["data"]),d("div",k,[f(E).loading&&f(K)?(m(),c("span",H,g(f(A)("loading")),1)):I("",!0)])],8,L)),[[i,$]])}}});export{T as default};
