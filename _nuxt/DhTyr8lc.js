import{f as e,B as l,ad as a,s,C as t,b5 as o,b6 as n,aa as i,c as u,o as r,F as d,b as c,i as m,J as v,L as p,O as b,a0 as g,K as f,j as y,bj as w,w as x,d as k,k as h,t as B,b4 as _,I as V,l as T,a as S,at as A,ai as F,Y as N,b8 as q,b9 as z,ba as I,bb as L,bc as C,bd as $,be as E,x as j,bf as M}from"./B65fceU8.js";const O={key:0,class:"ml-5px"},R={class:"text-20px"},U={class:"min-h-60px py-10px"},W={class:"text-16px"},D={class:"flex mt-10px"},G=e({__name:"quickSwap",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"medium"}},emits:["submitSwap"],setup(e,{emit:G}){const{t:J}=l(),K=e,P=a(),Q=s(!1),Y=s(!1),H=s(""),X=t("noReminderQuickBuy",!1),Z=G;function ee(){var e;if(Z("submitSwap"),!F())return;if(Q.value)return;if(new N(K.quickBuyValue||0).lte(0))return void q({title:"Error",type:"error",message:J("amountMustG0")});const{row:l}=K;H.value=J("quickBuyMsg",{a:K.quickBuyValue,m:(null==(e=_(K.row.chain))?void 0:e.main_name)||"",s:l.symbol||(l.target_token==l.token0_address?l.token0_symbol:l.token1_symbol)}),X.value?se():Y.value=!0}const le=s(),ae=o();async function se(){var e;Y.value=!1;const{chain:l}=K.row;Q.value=!0,await async function(e){var l;const a=P.getWalletAddress(e);if(!a)return;const s=await M({chain:e,tokens:[L(e)],walletAddress:a}),t=(null==s?void 0:s[0])||{};le.value={...t,symbol:null==(l=_(e))?void 0:l.main_name,chain:e,address:t.token||t.address,decimals:t.decimals||t.decimal}}(l);const a=le.value,s=null==(e=new N(K.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(s)||0)<=0?(q({title:"Error",type:"error",message:J("amountTooSmall")}),void(Q.value=!1)):new N(s||0).gt((null==a?void 0:a.balance)||0)?(q({title:"Error",type:"error",message:J("insufficientBalance")}),void(Q.value=!1)):void async function(e){var l,a,s;const{chain:t}=K.row,o="solana"===t,{botSettings:n}=ae,i=null==(l=null==n?void 0:n[t])?void 0:l.selected,u=null==(a=null==n?void 0:n[t])?void 0:a[i];if(o&&(null==u?void 0:u.mev)&&!(await P.getBundleAvailable()))return void(Q.value=!1);const{gasTip1List:r,gasTip2List:d}=z(I().gasTip,"solana"),c=(null==u?void 0:u.mev)?r:d,m=(null==u?void 0:u.mev)?null==u?void 0:u.gas[0]:null==(s=null==u?void 0:u.gas)?void 0:s[1];let v={};if(o){let e=(null==m?void 0:m.customFee)||(null==c?void 0:c[null==m?void 0:m.level])||"0.002";(null==u?void 0:u.mev)&&new N(e).lt("0.002")&&(e="0.002"),v.priorityFee=new N(e).times(10**9).toFixed(0)}else{const e=0===Number(null==m?void 0:m.customFee)?"0":(null==m?void 0:m.customFee)||(null==c?void 0:c[null==m?void 0:m.level])||"3";v.gasTip=Number(new N(e).times(10**9).toFixed(0)),v.contractType=0,v.chain=t}const p=L(t),b=(null==u?void 0:u.slippage)||"9",g=P.getWalletAddress(t);if(!g)return;v={...v,batchId:Date.now().toString(),swapList:[{creatorAddress:g,inAmount:new N(e||0).times(10**le.value.decimals||0).toFixed(0)}],inTokenAddress:p,outTokenAddress:K.row.token||K.row.target_token,swapType:1,isPrivate:(null==u?void 0:u.mev)||!1,slippage:"auto"!==b?Number(new N(b).times(100).toFixed(0)):900,autoSell:(null==u?void 0:u.autoSell)||!1};(o?C(v):$(v)).then(e=>function(e,l){if(e){let e=setTimeout(()=>{q({type:"success",message:J("transactionsSubmitted")}),te.placeOrderUpdate++,Q.value=!1},500);const a=j(()=>oe.wsResult.tgbot,s=>{var t,o,n,i;s.batchId===l&&(e&&(clearTimeout(e),e=null),te.placeOrderSuccess++,(null==(o=null==(t=null==s?void 0:s.txList)?void 0:t[0])?void 0:o.success)?(q({type:"success",message:J("tradeSuccess")}),a()):(E((null==(i=null==(n=null==s?void 0:s.txList)?void 0:n[0])?void 0:i.failMessage)||"swap error"),a()),Q.value=!1)})}}(e,v.batchId)).catch(e=>{E(e||"swap error"),Q.value=!1})}(s)}const te=n(),oe=i();return(e,l)=>{const a=h,s=p,t=A,o=V;return r(),u(d,null,[c(s,{disabled:!Number(e.quickBuyValue),loading:y(Q),color:e.buttonBg,class:f(["flex items-center [&&]:px-12px",e.classNames]),style:g([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":y(w)(e.size).text}]),onClick:b(ee,["stop","prevent"])},{default:x(()=>{var l;return[c(a,{style:g({"font-size":y(w)(e.size).flash}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"]),k(" "+B(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(r(),u("span",O,B((null==(l=("getChainInfo"in e?e.getChainInfo:y(_))(e.row.chain))?void 0:l.main_name)||""),1)):v("",!0)]}),_:1},8,["disabled","loading","color","class","style"]),y(Y)?(r(),m(o,{key:0,modelValue:y(Y),"onUpdate:modelValue":l[1]||(l[1]=e=>T(Y)?Y.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:x(()=>[S("span",R,B(e.$t("buy")),1)]),footer:x(()=>[c(s,{type:"primary",class:"w-full",size:"large",onClick:b(se,["stop"])},{default:x(()=>[k(B(e.$t("confirm1")),1)]),_:1})]),default:x(()=>[S("div",U,[S("div",W,B(y(H)),1),S("div",D,[c(t,{modelValue:y(X),"onUpdate:modelValue":l[0]||(l[0]=e=>T(X)?X.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])]),_:1},8,["modelValue","title","append-to"])):v("",!0)],64)}}});export{G as _};
